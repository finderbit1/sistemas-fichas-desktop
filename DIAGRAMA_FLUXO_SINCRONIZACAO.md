# ğŸ“Š Diagrama de Fluxo - Sistema de SincronizaÃ§Ã£o

## ğŸ”„ Fluxo Completo de AtualizaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUXO DE ATUALIZAÃ‡ÃƒO DE PEDIDO                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cliente 1   â”‚         â”‚  Cliente 2   â”‚         â”‚  Cliente N   â”‚
â”‚ (React/Tauri)â”‚         â”‚ (React/Tauri)â”‚         â”‚ (React/Tauri)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚ 1. User clica          â”‚                        â”‚
       â”‚    checkbox            â”‚                        â”‚
       â”‚    (financeiro)        â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â”‚ 2. updatePedido()      â”‚                        â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
       â”‚                        â”‚                        â”‚      â”‚
       â”‚              HTTP PATCH /api/v1/pedidos/123    â”‚      â”‚
       â”‚              Body: { "financeiro": true }       â”‚      â”‚
       â”‚                        â”‚                        â”‚      â”‚
       â”‚                        â–¼                        â”‚      â”‚
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
       â”‚              â”‚   FastAPI Backend   â”‚            â”‚      â”‚
       â”‚              â”‚                     â”‚            â”‚      â”‚
       â”‚              â”‚ 3. Validar dados    â”‚            â”‚      â”‚
       â”‚              â”‚ 4. Iniciar transaÃ§Ã£oâ”‚            â”‚      â”‚
       â”‚              â”‚ 5. UPDATE no SQLite â”‚            â”‚      â”‚
       â”‚              â”‚ 6. Commit           â”‚            â”‚      â”‚
       â”‚              â”‚ 7. Atualizar updatedâ”‚            â”‚      â”‚
       â”‚              â”‚    _at timestamp    â”‚            â”‚      â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
       â”‚                         â”‚                       â”‚      â”‚
       â”‚                         â”‚ 8. Broadcast WebSocketâ”‚      â”‚
       â”‚                         â”‚    para TODOS         â”‚      â”‚
       â”‚                         â”‚                       â”‚      â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚                       â”‚
       â”‚ 9. Recebe WS msg        â”‚ 9. Recebe WS msg      â”‚ 9. Recebe WS msg
       â”‚    type: pedido_update  â”‚    type: pedido_updateâ”‚    type: pedido_update
       â”‚    pedido_id: 123       â”‚    pedido_id: 123     â”‚    pedido_id: 123
       â”‚    data: {...}          â”‚    data: {...}        â”‚    data: {...}
       â”‚                         â”‚                       â”‚
       â”‚ 10. updatePedidoLocal() â”‚ 10. updatePedidoLocal()â”‚ 10. updatePedidoLocal()
       â”‚     setPedidos(...)     â”‚     setPedidos(...)   â”‚     setPedidos(...)
       â”‚                         â”‚                       â”‚
       â”‚ 11. UI atualiza âœ…      â”‚ 11. UI atualiza âœ…    â”‚ 11. UI atualiza âœ…
       â”‚     automaticamente     â”‚     automaticamente   â”‚     automaticamente
       â”‚                         â”‚                       â”‚
       â–¼                         â–¼                       â–¼
  âœ… Sincronizado          âœ… Sincronizado         âœ… Sincronizado
```

## ğŸ”Œ Fluxo de ConexÃ£o WebSocket

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONEXÃƒO E RECONEXÃƒO WEBSOCKET                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Cliente                                        Servidor
      â”‚                                               â”‚
      â”‚ 1. Componente monta                          â”‚
      â”‚    useWebSocket() Ã© chamado                  â”‚
      â”‚                                               â”‚
      â”‚ 2. new WebSocket(url)                        â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚           WS Handshake                        â”‚
      â”‚                                               â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚        3. ws.onopen                           â”‚ 3. ws_manager.connect()
      â”‚           setIsConnected(true)                â”‚    Registra conexÃ£o
      â”‚           startHeartbeat()                    â”‚
      â”‚                                               â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚     4. Mensagem de boas-vindas                â”‚ 4. send_personal_message()
      â”‚        { type: "connection",                  â”‚    { status: "connected" }
      â”‚          status: "connected" }                â”‚
      â”‚                                               â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
      â”‚  â”‚   Loop de Heartbeat (30s)      â”‚          â”‚
      â”‚  â”‚                                 â”‚          â”‚
      â”‚  â”‚ 5. Enviar ping                 â”‚          â”‚
      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚  â”‚    { type: "ping" }                        â”‚ 5. Receber ping
      â”‚  â”‚                                             â”‚
      â”‚  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  â”‚ 6. Receber pong                            â”‚ 6. Enviar pong
      â”‚  â”‚    { type: "pong" }                        â”‚    { type: "pong" }
      â”‚  â”‚                                             â”‚
      â”‚  â”‚ ... aguardar 30s ...                       â”‚
      â”‚  â”‚                                             â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
      â”‚                                               â”‚
      â–¼                                               â–¼
```

## ğŸ”„ Fluxo de ReconexÃ£o AutomÃ¡tica

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RECONEXÃƒO AUTOMÃTICA                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Cliente                                        Servidor
      â”‚                                               â”‚
      â”‚ âœ… Conectado normalmente                      â”‚ âœ… Servidor funcionando
      â”‚                                               â”‚
      â”‚                                               â•³ âŒ Servidor cai
      â”‚                                               â”‚    ou rede cai
      â”‚                                               â”‚
      â•³ âŒ ws.onclose                                 â”‚
      â”‚    setIsConnected(false)                     â”‚
      â”‚    setConnectionState('disconnected')        â”‚
      â”‚                                               â”‚
      â”‚ ğŸ”„ Iniciar tentativa de reconexÃ£o            â”‚
      â”‚    setTimeout(() => connect(), 3000)         â”‚
      â”‚                                               â”‚
      â”‚ ... aguardar 3 segundos ...                  â”‚
      â”‚                                               â”‚
      â”‚ Tentativa 1                                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â•³ âŒ Falha
      â”‚                                               â”‚
      â”‚ setReconnectAttempt(1)                       â”‚
      â”‚ UI mostra: "Tentativa 1"                     â”‚
      â”‚                                               â”‚
      â”‚ ... aguardar 3 segundos ...                  â”‚
      â”‚                                               â”‚
      â”‚ Tentativa 2                                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â•³ âŒ Falha
      â”‚                                               â”‚
      â”‚ setReconnectAttempt(2)                       â”‚
      â”‚ UI mostra: "Tentativa 2"                     â”‚
      â”‚                                               â”‚
      â”‚ ... aguardar 3 segundos ...                  â”‚
      â”‚                                               â–²
      â”‚                                               âœ… Servidor volta
      â”‚                                               â”‚
      â”‚ Tentativa 3                                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ âœ… Sucesso!
      â”‚           WS Handshake                        â”‚
      â”‚                                               â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ âœ… ws.onopen                                  â”‚ ws_manager.connect()
      â”‚    setIsConnected(true)                       â”‚
      â”‚    setReconnectAttempt(0)                    â”‚
      â”‚    fetchPedidos() // Recarregar dados        â”‚
      â”‚                                               â”‚
      â”‚ UI mostra: "âœ… Sincronizado"                  â”‚
      â”‚                                               â”‚
      â–¼                                               â–¼
```

## ğŸ“¦ Arquitetura de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ARQUITETURA DO SISTEMA                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Seu Componente React                         â”‚   â”‚
â”‚  â”‚  (ex: ListaPedidos.jsx, KanbanBoard.jsx, etc)                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â”‚ usa                                      â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              usePedidosSync()  (Hook)                          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Estado: pedidos, isLoading, wsConnected                     â”‚   â”‚
â”‚  â”‚  â€¢ FunÃ§Ãµes: updatePedido(), createPedido(), deletePedido()    â”‚   â”‚
â”‚  â”‚  â€¢ Callbacks: onPedidoCreate, onPedidoUpdate, etc             â”‚   â”‚
â”‚  â”‚  â€¢ Logs: syncLog                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚             â”‚                            â”‚
â”‚                              â”‚ usa         â”‚ usa                        â”‚
â”‚                              â–¼             â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   useWebSocket()     â”‚   â”‚      api.js             â”‚               â”‚
â”‚  â”‚   (Hook genÃ©rico)    â”‚   â”‚  (HTTP requests)        â”‚               â”‚
â”‚  â”‚                      â”‚   â”‚                         â”‚               â”‚
â”‚  â”‚ â€¢ ConexÃ£o WS         â”‚   â”‚ â€¢ GET /pedidos/         â”‚               â”‚
â”‚  â”‚ â€¢ ReconexÃ£o auto     â”‚   â”‚ â€¢ PATCH /pedidos/:id    â”‚               â”‚
â”‚  â”‚ â€¢ Heartbeat          â”‚   â”‚ â€¢ POST /pedidos/        â”‚               â”‚
â”‚  â”‚ â€¢ Mensagens          â”‚   â”‚ â€¢ DELETE /pedidos/:id   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚              â”‚                         â”‚                                â”‚
â”‚              â”‚ WebSocket               â”‚ HTTP                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                         â”‚
               â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACKEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚                         â”‚                                 â”‚
â”‚              â–¼                         â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  WebSocket Manager  â”‚   â”‚   Pedidos Router         â”‚                â”‚
â”‚  â”‚  websocket_manager  â”‚   â”‚   pedidos/router.py      â”‚                â”‚
â”‚  â”‚                     â”‚   â”‚                          â”‚                â”‚
â”‚  â”‚ â€¢ connect()         â”‚â—„â”€â”€â”¤ â€¢ criar_pedido()         â”‚                â”‚
â”‚  â”‚ â€¢ disconnect()      â”‚   â”‚   â””â”€> broadcast()        â”‚                â”‚
â”‚  â”‚ â€¢ broadcast()       â”‚â—„â”€â”€â”¤ â€¢ atualizar_pedido()     â”‚                â”‚
â”‚  â”‚ â€¢ get_stats()       â”‚   â”‚   â””â”€> broadcast()        â”‚                â”‚
â”‚  â”‚                     â”‚â—„â”€â”€â”¤ â€¢ deletar_pedido()       â”‚                â”‚
â”‚  â”‚ Gerencia conexÃµes   â”‚   â”‚   â””â”€> broadcast()        â”‚                â”‚
â”‚  â”‚ ativas dos clientes â”‚   â”‚                          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                       â”‚                                 â”‚
â”‚                                       â”‚ usa                             â”‚
â”‚                                       â–¼                                 â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                            â”‚   Database           â”‚                    â”‚
â”‚                            â”‚   database.py        â”‚                    â”‚
â”‚                            â”‚                      â”‚                    â”‚
â”‚                            â”‚ â€¢ SQLite + WAL mode  â”‚                    â”‚
â”‚                            â”‚ â€¢ TransaÃ§Ãµes atÃ´micasâ”‚                    â”‚
â”‚                            â”‚ â€¢ Campo updated_at   â”‚                    â”‚
â”‚                            â”‚ â€¢ Pool de conexÃµes   â”‚                    â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Fluxo de Dados Simplificado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FLUXO DE DADOS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   User Action (UI)
        â”‚
        â–¼
   updatePedido(id, data)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º HTTP PATCH /api/v1/pedidos/123
        â”‚                                       â”‚
        â”‚                                       â–¼
        â”‚                               Backend processa
        â”‚                                       â”‚
        â”‚                                       â–¼
        â”‚                               UPDATE no SQLite
        â”‚                                       â”‚
        â”‚                                       â–¼
        â”‚                         WebSocket Broadcast para TODOS
        â”‚                                       â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚              â”‚
        â–¼                                       â–¼              â–¼
   Cliente 1 recebe                       Cliente 2        Cliente N
        â”‚                                 recebe           recebe
        â–¼                                    â”‚               â”‚
   updatePedidoLocal(data)                   â”‚               â”‚
        â”‚                                    â”‚               â”‚
        â–¼                                    â–¼               â–¼
   setPedidos(...)                 setPedidos(...)  setPedidos(...)
        â”‚                                    â”‚               â”‚
        â–¼                                    â–¼               â–¼
   React re-render                  React re-render  React re-render
        â”‚                                    â”‚               â”‚
        â–¼                                    â–¼               â–¼
   UI atualiza âœ…                    UI atualiza âœ…    UI atualiza âœ…
```

## ğŸ” Garantias do Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       GARANTIAS DE CONSISTÃŠNCIA                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ATOMICIDADE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Banco de Dados         â”‚
   â”‚  (SQLite + WAL)         â”‚
   â”‚                         â”‚
   â”‚  BEGIN TRANSACTION      â”‚
   â”‚  UPDATE pedidos ...     â”‚
   â”‚  COMMIT                 â”‚ âœ… Tudo ou nada
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. ORDENAÃ‡ÃƒO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Timestamp              â”‚
   â”‚  (ultima_atualizacao)   â”‚
   â”‚                         â”‚
   â”‚  2025-10-10 12:30:01    â”‚ âœ… Sempre atualizado
   â”‚  2025-10-10 12:30:02    â”‚    Resolve conflitos
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. BROADCAST GARANTIDO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  WebSocket Manager      â”‚
   â”‚                         â”‚
   â”‚  for cada cliente:      â”‚
   â”‚    try:                 â”‚
   â”‚      enviar(msg)        â”‚ âœ… Tenta todos
   â”‚    except:              â”‚    Remove falhas
   â”‚      remover_cliente    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. NUNCA ATUALIZAR ANTES DO SERVIDOR
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Cliente                â”‚
   â”‚                         â”‚
   â”‚  âŒ NUNCA:              â”‚
   â”‚     setPedidos(...)     â”‚
   â”‚     await api.patch()   â”‚
   â”‚                         â”‚
   â”‚  âœ… SEMPRE:             â”‚
   â”‚     await api.patch()   â”‚ âœ… Servidor primeiro
   â”‚     // WS atualiza auto â”‚    WS atualiza todos
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š MÃ©tricas de Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MÃ‰TRICAS DE PERFORMANCE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ©trica                 â”‚ Valor        â”‚ ObservaÃ§Ã£o          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Clientes Suportados     â”‚ ~20          â”‚ Testado e otimizado â”‚
â”‚ LatÃªncia de Broadcast   â”‚ < 100ms      â”‚ Rede local          â”‚
â”‚ Tempo de ReconexÃ£o      â”‚ < 3s         â”‚ ApÃ³s queda          â”‚
â”‚ Intervalo de Heartbeat  â”‚ 30s          â”‚ ConfigurÃ¡vel        â”‚
â”‚ Timeout de Banco        â”‚ 30s          â”‚ Evita locks         â”‚
â”‚ Tamanho de Cache        â”‚ 50.000 pÃ¡g   â”‚ SQLite              â”‚
â”‚ Logs Mantidos           â”‚ 50 eventos   â”‚ Por cliente         â”‚
â”‚ Tentativas de ReconexÃ£o â”‚ Infinitas    â”‚ ConfigurÃ¡vel        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ“š Mais informaÃ§Ãµes:**
- DocumentaÃ§Ã£o completa: `documentation/SISTEMA_SINCRONIZACAO_TEMPO_REAL.md`
- Guia rÃ¡pido: `GUIA_RAPIDO_SINCRONIZACAO.md`
- Testes: `TESTE_SINCRONIZACAO.md`


